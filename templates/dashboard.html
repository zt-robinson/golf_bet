{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-tachometer-alt me-2"></i>
            Dashboard
        </h1>
    </div>
</div>

{% if user %}
<!-- Balance Display -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card text-center p-3 mb-3">
            <h5 class="card-title">Virtual Balance</h5>
            <p class="card-text display-4">${{ "%.2f"|format(user.virtual_balance) }}</p>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card p-3 mb-3">
             <h5 class="card-title text-center">Welcome, {{ user.username }}!</h5>
             <p class="card-text text-center text-muted">You have {{ bets|length }} total bets.</p>
        </div>
    </div>
</div>

<!-- Current Tournament -->
{% if current_tournament %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-trophy me-2"></i>
                    Current Tournament: {{ current_tournament.Name }}
                </h4>
            </div>
            <div class="card-body">
                <h5 class="card-title">{{ current_tournament.Name }}</h5>
                <p class="card-text">
                    <i class="fas fa-calendar-alt me-2"></i>
                    {{ current_tournament.StartDate.strftime('%B %d, %Y') }} - {{ current_tournament.EndDate.strftime('%B %d, %Y') }}
                </p>
                <a href="{{ url_for('leaderboard', tournament_id=current_tournament.TournamentID) }}" class="btn btn-secondary">
                    <i class="fas fa-trophy me-2"></i>Full Leaderboard
                </a>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Betting History -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-history me-2"></i>
                    Betting History
                </h4>
            </div>
            <div class="card-body">
                {% if bets %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Tournament</th>
                                <th>Player</th>
                                <th>Bet Amount</th>
                                <th>Odds</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for bet in bets %}
                            <tr>
                                <td>{{ bet.created_at.split(' ')[0] }}</td>
                                <td>{{ bet.tournament_name }}</td>
                                <td>{{ bet.player_name }}</td>
                                <td>${{ "%.2f"|format(bet.bet_amount) }}</td>
                                <td>{{ bet.odds }}x</td>
                                <td>
                                    <span class="badge 
                                        {% if bet.status == 'won' %}bg-success
                                        {% elif bet.status == 'lost' %}bg-danger
                                        {% else %}bg-warning text-dark
                                        {% endif %}">
                                        {{ bet.status.title() }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-coins fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No bets placed yet</h5>
                    <p class="text-muted">You can place bets from the tournament pages.</p>
                    <a href="{{ url_for('home') }}" class="btn btn-primary">
                        <i class="fas fa-home me-2"></i>View Tournaments
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Betting Statistics -->
{% if bets %}
<div class="row mt-4">
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Total Bets</h5>
                <h3 class="text-primary">{{ bets|length }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Won Bets</h5>
                <h3 class="text-success">{{ bets|selectattr('status', 'equalto', 'won')|list|length }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Pending Bets</h5>
                <h3 class="text-warning">{{ bets|selectattr('status', 'equalto', 'pending')|list|length }}</h3>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% else %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-warning text-center">
            <h4><i class="fas fa-exclamation-triangle me-2"></i>Please Log In</h4>
            <p>You need to be logged in to view your dashboard.</p>
            <a href="{{ url_for('login') }}" class="btn btn-primary">Login</a>
        </div>
    </div>
</div>
{% endif %}
{% endblock %} 